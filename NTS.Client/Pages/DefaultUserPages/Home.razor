@page "/home"
@inherits HomeBase
@attribute [Authorize(Roles = "DefaultUser")]

<MudContainer Class="mt-20">
    <div>
        @if (sharedNotesList.Count > 0)
        {
            @foreach (var note in sharedNotesList)
            {
                <MudCard Class="mb-4">
                    <MudCardContent>
                        <MudText Typo="Typo.h6">@note.Title</MudText>
                        <MudText Typo="Typo.body1">@note.Content</MudText>

                        <MudButton OnClick="@(() => LoadComments(note.NoteId))" Color="Color.Primary" Variant="Variant.Outlined">
                            View Comments
                        </MudButton>

                        @if (noteComments.ContainsKey(note.NoteId) && noteComments[note.NoteId].Count > 0)
                        {
                            <ul class="space-y-4 mt-3">
                                @foreach (var comment in noteComments[note.NoteId])
                                {
                                    <li class="flex items-start space-x-3">
                                        <div>
                                            <MudText Typo="Typo.h6" Class="font-bold">@comment.FullName</MudText>
                                            <MudText Class="text-sm">@comment.Content</MudText>
                                            <MudText Class="text-xs text-gray-500">@comment.CreatedAt.ToString("MM/dd/yyyy hh:mm tt")</MudText>
                                        </div>
                                    </li>
                                }
                            </ul>
                        }
                        else
                        {
                            <MudText Class="text-gray-500 mt-2">No comments yet...</MudText>
                        }

                        <MudContainer Class="mt-3">
                            <MudInput @bind-Value="@newCommentContent" Placeholder="Write a Comment..." FullWidth="true" Variant="Variant.Outlined" Class="bg-gray-100 rounded-lg" />
                            <MudButton OnClick="@(() => SendComment(note.NoteId))" Color="Color.Primary" Class="mt-2" FullWidth="true" Disabled="string.IsNullOrWhiteSpace(newCommentContent)">
                                Send
                            </MudButton>
                        </MudContainer>
                    </MudCardContent>
                </MudCard>
            }
        }
        else
        {
            <MudText Typo="Typo.h6" Class="text-gray-500">No shared notes available.</MudText>
        }
    </div>
</MudContainer>